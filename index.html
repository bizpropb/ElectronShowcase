<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta http-equiv="Content-Security-Policy"
        content="default-src 'self'; script-src 'self' 'unsafe-inline'; style-src 'self' 'unsafe-inline'">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Electron Feature Explorer</title>

  <!-- CSS Files -->
  <link rel="stylesheet" href="styles/theme.css">
  <link rel="stylesheet" href="styles/animations.css">
  <link rel="stylesheet" href="styles/main.css">
</head>
<body>
  <div class="container">
    <!-- Header -->
    <header class="header fade-in">
      <div class="header-title">
        <span class="icon">‚ö°</span>
        <h1>Electron Feature Explorer</h1>
      </div>
      <p class="header-subtitle">
        A comprehensive showcase of Electron's native desktop capabilities
      </p>
      <div class="flex items-center gap-4 mt-4">
        <span class="badge success">‚úì Secure</span>
        <span class="badge info">Platform: <span id="platform">...</span></span>
        <span class="badge">Electron <span id="electron-version">...</span></span>
      </div>
    </header>

    <!-- Window Management Category -->
    <section class="category-section fade-in">
      <div class="category-header">
        <span class="category-icon">ü™ü</span>
        <h2 class="category-title">Window Management</h2>
        <span class="category-count">4 features</span>
      </div>

      <div class="features-grid">
        <div class="card">
          <div class="card-header">
            <span class="card-icon">üé®</span>
            <h3 class="card-title">Multi-Window</h3>
          </div>
          <p class="card-description">
            Create and manage multiple windows with proper lifecycle management and state persistence.
          </p>
          <span class="card-status coming-soon">Coming Soon</span>
        </div>

        <div class="card">
          <div class="card-header">
            <span class="card-icon">üñºÔ∏è</span>
            <h3 class="card-title">Frameless Window</h3>
          </div>
          <p class="card-description">
            Custom window chrome with draggable regions and custom title bar controls.
          </p>
          <span class="card-status coming-soon">Coming Soon</span>
        </div>

        <div class="card">
          <div class="card-header">
            <span class="card-icon">üëª</span>
            <h3 class="card-title">Transparent Window</h3>
          </div>
          <p class="card-description">
            Create overlay windows with transparency and click-through functionality.
          </p>
          <span class="card-status coming-soon">Coming Soon</span>
        </div>

        <div class="card">
          <div class="card-header">
            <span class="card-icon">üìê</span>
            <h3 class="card-title">Window State</h3>
          </div>
          <p class="card-description">
            Persist window bounds, position, and state across application restarts.
          </p>
          <span class="card-status coming-soon">Coming Soon</span>
        </div>
      </div>
    </section>

    <!-- System Integration Category -->
    <section class="category-section fade-in">
      <div class="category-header">
        <span class="category-icon">‚öôÔ∏è</span>
        <h2 class="category-title">System Integration</h2>
        <span class="category-count">5 features</span>
      </div>

      <div class="features-grid">
        <div class="card" id="notifications-card" style="grid-column: span 2;">
          <div class="card-header">
            <span class="card-icon">üîî</span>
            <h3 class="card-title">Desktop Notifications System</h3>
          </div>
          <p class="card-description">
            Comprehensive notification system with actions, replies, Do Not Disturb, queue management, and history tracking.
          </p>

          <!-- Notification Types -->
          <div style="margin-top: var(--space-4);">
            <h4 style="font-size: var(--font-size-sm); color: var(--text-secondary); margin-bottom: var(--space-2);">Basic Notifications</h4>
            <div style="display: grid; grid-template-columns: repeat(4, 1fr); gap: var(--space-2);">
              <button class="btn btn-primary" id="notify-info">Info</button>
              <button class="btn btn-success" id="notify-success">Success</button>
              <button class="btn btn-warning" id="notify-warning">Warning</button>
              <button class="btn btn-error" id="notify-error">Error</button>
            </div>
          </div>

          <!-- Advanced Notifications -->
          <div style="margin-top: var(--space-4);">
            <h4 style="font-size: var(--font-size-sm); color: var(--text-secondary); margin-bottom: var(--space-2);">Advanced Features</h4>
            <div style="display: grid; grid-template-columns: repeat(3, 1fr); gap: var(--space-2);">
              <button class="btn btn-primary" id="notify-with-actions">With Actions</button>
              <button class="btn btn-primary" id="notify-with-reply">With Reply</button>
              <button class="btn btn-primary" id="notify-silent">Silent</button>
            </div>
          </div>

          <!-- Do Not Disturb & Management -->
          <div style="margin-top: var(--space-4);">
            <h4 style="font-size: var(--font-size-sm); color: var(--text-secondary); margin-bottom: var(--space-2);">Management & Controls</h4>
            <div style="display: grid; grid-template-columns: repeat(4, 1fr); gap: var(--space-2);">
              <button class="btn" id="notify-dnd-toggle" style="background: var(--bg-tertiary);">
                <span id="dnd-status">DND: Off</span>
              </button>
              <button class="btn" id="notify-show-history">View History</button>
              <button class="btn" id="notify-show-queue">View Queue</button>
              <button class="btn" id="notify-close-all">Close All</button>
            </div>
          </div>

          <!-- Statistics Display -->
          <div id="notification-stats" style="margin-top: var(--space-4); padding: var(--space-3); background: var(--bg-tertiary); border-radius: 6px; font-size: var(--font-size-xs); color: var(--text-secondary);">
            <strong>Stats:</strong>
            <span id="stats-total">0</span> total ‚Ä¢
            <span id="stats-history">0</span> in history ‚Ä¢
            <span id="stats-queued">0</span> queued ‚Ä¢
            <span id="stats-active">0</span> active
          </div>

          <!-- Event Log -->
          <div id="notification-log" style="margin-top: var(--space-3); padding: var(--space-3); background: var(--bg-tertiary); border-radius: 6px; max-height: 120px; overflow-y: auto; font-size: var(--font-size-xs); font-family: monospace; color: var(--text-secondary);">
            <div style="color: var(--text-primary); margin-bottom: var(--space-2);">Event Log:</div>
            <div id="notification-log-content">Ready to show notifications...</div>
          </div>

          <span class="card-status ready">‚úì Ready</span>
        </div>

        <div class="card">
          <div class="card-header">
            <span class="card-icon">üìã</span>
            <h3 class="card-title">System Tray</h3>
          </div>
          <p class="card-description">
            Persistent tray icon with context menu and quick actions.
          </p>
          <span class="card-status coming-soon">Coming Soon</span>
        </div>

        <div class="card">
          <div class="card-header">
            <span class="card-icon">üéØ</span>
            <h3 class="card-title">App Menu</h3>
          </div>
          <p class="card-description">
            Native application menu with keyboard shortcuts and dynamic items.
          </p>
          <span class="card-status coming-soon">Coming Soon</span>
        </div>

        <div class="card">
          <div class="card-header">
            <span class="card-icon">‚å®Ô∏è</span>
            <h3 class="card-title">Global Shortcuts</h3>
          </div>
          <p class="card-description">
            Register system-wide keyboard shortcuts for quick app control.
          </p>
          <span class="card-status coming-soon">Coming Soon</span>
        </div>

        <div class="card">
          <div class="card-header">
            <span class="card-icon">üñ±Ô∏è</span>
            <h3 class="card-title">Context Menus</h3>
          </div>
          <p class="card-description">
            Rich right-click context menus with dynamic items and submenus.
          </p>
          <span class="card-status coming-soon">Coming Soon</span>
        </div>
      </div>
    </section>

    <!-- File System Category -->
    <section class="category-section fade-in">
      <div class="category-header">
        <span class="category-icon">üìÅ</span>
        <h2 class="category-title">File System</h2>
        <span class="category-count">4 features</span>
      </div>

      <div class="features-grid">
        <div class="card" id="file-dialogs-card" style="grid-column: span 2;">
          <div class="card-header">
            <span class="card-icon">üìÇ</span>
            <h3 class="card-title">File Dialogs & Operations</h3>
          </div>
          <p class="card-description">
            Native dialogs, file I/O, metadata extraction, and recent files tracking.
          </p>

          <!-- Dialog Buttons -->
          <div style="margin-top: var(--space-4);">
            <h4 style="font-size: var(--font-size-sm); color: var(--text-secondary); margin-bottom: var(--space-2);">File Dialogs</h4>
            <div style="display: grid; grid-template-columns: repeat(4, 1fr); gap: var(--space-2);">
              <button class="btn btn-primary" id="dialog-open">Open File</button>
              <button class="btn btn-primary" id="dialog-multiple">Open Multiple</button>
              <button class="btn btn-success" id="dialog-directory">Select Folder</button>
              <button class="btn btn-warning" id="dialog-save">Save File</button>
            </div>
          </div>

          <!-- Message Boxes -->
          <div style="margin-top: var(--space-4);">
            <h4 style="font-size: var(--font-size-sm); color: var(--text-secondary); margin-bottom: var(--space-2);">Message Boxes</h4>
            <div style="display: grid; grid-template-columns: repeat(4, 1fr); gap: var(--space-2);">
              <button class="btn" id="msgbox-info" style="background: var(--accent-blue);">Info Box</button>
              <button class="btn" id="msgbox-warning" style="background: var(--accent-yellow);">Warning</button>
              <button class="btn" id="msgbox-error" style="background: var(--accent-red);">Error</button>
              <button class="btn" id="msgbox-question" style="background: var(--accent-green);">Question</button>
            </div>
          </div>

          <!-- File Operations -->
          <div style="margin-top: var(--space-4);">
            <h4 style="font-size: var(--font-size-sm); color: var(--text-secondary); margin-bottom: var(--space-2);">File Operations</h4>
            <div style="display: grid; grid-template-columns: repeat(3, 1fr); gap: var(--space-2);">
              <button class="btn" id="file-read-preview" style="background: var(--bg-tertiary);">Read & Preview</button>
              <button class="btn" id="file-metadata" style="background: var(--bg-tertiary);">Get Metadata</button>
              <button class="btn" id="file-recent" style="background: var(--bg-tertiary);">Recent Files</button>
            </div>
          </div>

          <!-- Result Display -->
          <div id="dialog-result" style="margin-top: var(--space-3); padding: var(--space-3); background: var(--bg-tertiary); border-radius: 6px; font-size: var(--font-size-xs); color: var(--text-secondary); min-height: 60px;">
            <div style="color: var(--text-primary); margin-bottom: var(--space-2);">Result:</div>
            <div id="dialog-result-content">Ready...</div>
          </div>

          <span class="card-status ready">‚úì Ready</span>
        </div>

        <div class="card" id="drag-drop-card">
          <div class="card-header">
            <span class="card-icon">üéØ</span>
            <h3 class="card-title">Drag & Drop Files</h3>
          </div>
          <p class="card-description">
            Drop files here to process them with validation and preview.
          </p>

          <!-- Drop Zone -->
          <div id="drop-zone" style="margin-top: var(--space-4); padding: var(--space-6); border: 2px dashed var(--border); border-radius: 8px; text-align: center; background: var(--bg-tertiary); cursor: pointer; transition: all 0.2s;">
            <div style="font-size: 48px; margin-bottom: var(--space-2);">üìÅ</div>
            <div style="color: var(--text-primary); margin-bottom: var(--space-1);">Drop files here</div>
            <div style="font-size: var(--font-size-xs); color: var(--text-secondary);">or click to browse</div>
          </div>

          <!-- Dropped Files List -->
          <div id="dropped-files" style="margin-top: var(--space-3); font-size: var(--font-size-xs); color: var(--text-secondary); max-height: 120px; overflow-y: auto;"></div>

          <span class="card-status ready">‚úì Ready</span>
        </div>

        <div class="card" id="storage-card" style="grid-column: span 2;">
          <div class="card-header">
            <span class="card-icon">üíæ</span>
            <h3 class="card-title">Persistent Storage (electron-store)</h3>
          </div>
          <p class="card-description">
            Key-value storage with schema validation, encryption, export/import, and migrations.
          </p>

          <!-- CRUD Operations -->
          <div style="margin-top: var(--space-4);">
            <h4 style="font-size: var(--font-size-sm); color: var(--text-secondary); margin-bottom: var(--space-2);">Basic Operations</h4>
            <div style="display: grid; grid-template-columns: repeat(2, 1fr); gap: var(--space-2); margin-bottom: var(--space-2);">
              <input type="text" id="store-key" placeholder="Key (e.g., theme)" style="padding: 8px; background: var(--bg-tertiary); border: 1px solid var(--border); border-radius: 4px; color: var(--text-primary);">
              <input type="text" id="store-value" placeholder="Value (e.g., dark)" style="padding: 8px; background: var(--bg-tertiary); border: 1px solid var(--border); border-radius: 4px; color: var(--text-primary);">
            </div>
            <div style="display: grid; grid-template-columns: repeat(4, 1fr); gap: var(--space-2);">
              <button class="btn btn-success" id="store-set">Set Value</button>
              <button class="btn btn-primary" id="store-get">Get Value</button>
              <button class="btn btn-warning" id="store-delete">Delete Key</button>
              <button class="btn" id="store-has" style="background: var(--bg-tertiary);">Check Exists</button>
            </div>
          </div>

          <!-- Encrypted Secrets -->
          <div style="margin-top: var(--space-4);">
            <h4 style="font-size: var(--font-size-sm); color: var(--text-secondary); margin-bottom: var(--space-2);">Encrypted Secrets</h4>
            <div style="display: grid; grid-template-columns: repeat(2, 1fr); gap: var(--space-2); margin-bottom: var(--space-2);">
              <input type="text" id="secret-key" placeholder="Secret key (e.g., apiKey)" style="padding: 8px; background: var(--bg-tertiary); border: 1px solid var(--border); border-radius: 4px; color: var(--text-primary);">
              <input type="password" id="secret-value" placeholder="Secret value" style="padding: 8px; background: var(--bg-tertiary); border: 1px solid var(--border); border-radius: 4px; color: var(--text-primary);">
            </div>
            <div style="display: grid; grid-template-columns: repeat(3, 1fr); gap: var(--space-2);">
              <button class="btn" id="secret-set" style="background: var(--accent-blue);">Set Secret</button>
              <button class="btn" id="secret-get" style="background: var(--bg-tertiary);">Get Secret</button>
              <button class="btn" id="secret-delete" style="background: var(--accent-red);">Delete Secret</button>
            </div>
          </div>

          <!-- Management & Inspection -->
          <div style="margin-top: var(--space-4);">
            <h4 style="font-size: var(--font-size-sm); color: var(--text-secondary); margin-bottom: var(--space-2);">Management & Inspection</h4>
            <div style="display: grid; grid-template-columns: repeat(4, 1fr); gap: var(--space-2);">
              <button class="btn" id="store-view-all" style="background: var(--bg-tertiary);">View All Data</button>
              <button class="btn" id="store-export" style="background: var(--accent-green);">Export JSON</button>
              <button class="btn" id="store-import" style="background: var(--accent-yellow);">Import JSON</button>
              <button class="btn" id="store-reset" style="background: var(--accent-red);">Reset to Defaults</button>
            </div>
          </div>

          <!-- Statistics -->
          <div id="store-stats" style="margin-top: var(--space-4); padding: var(--space-3); background: var(--bg-tertiary); border-radius: 6px; font-size: var(--font-size-xs); color: var(--text-secondary);">
            <strong>Store Stats:</strong>
            <span id="stats-keys">0</span> keys ‚Ä¢
            <span id="stats-size">0</span> bytes ‚Ä¢
            <span id="stats-secrets">0</span> secrets ‚Ä¢
            Path: <span id="stats-path">...</span>
          </div>

          <!-- Result Display -->
          <div id="store-result" style="margin-top: var(--space-3); padding: var(--space-3); background: var(--bg-tertiary); border-radius: 6px; font-size: var(--font-size-xs); color: var(--text-secondary); max-height: 200px; overflow-y: auto;">
            <div style="color: var(--text-primary); margin-bottom: var(--space-2);">Result:</div>
            <div id="store-result-content">Ready to store data...</div>
          </div>

          <span class="card-status ready">‚úì Ready</span>
        </div>
      </div>
    </section>

    <!-- OS Integration Category -->
    <section class="category-section fade-in">
      <div class="category-header">
        <span class="category-icon">üíª</span>
        <h2 class="category-title">OS Integration</h2>
        <span class="category-count">4 features</span>
      </div>

      <div class="features-grid">
        <div class="card">
          <div class="card-header">
            <span class="card-icon">üìã</span>
            <h3 class="card-title">Clipboard</h3>
          </div>
          <p class="card-description">
            Full clipboard access with multiple formats and history tracking.
          </p>
          <span class="card-status coming-soon">Coming Soon</span>
        </div>

        <div class="card">
          <div class="card-header">
            <span class="card-icon">üöÄ</span>
            <h3 class="card-title">Shell Integration</h3>
          </div>
          <p class="card-description">
            Open external URLs, reveal files, and execute shell commands.
          </p>
          <span class="card-status coming-soon">Coming Soon</span>
        </div>

        <div class="card">
          <div class="card-header">
            <span class="card-icon">üîã</span>
            <h3 class="card-title">Power Management</h3>
          </div>
          <p class="card-description">
            Monitor battery status, suspend/resume events, and idle detection.
          </p>
          <span class="card-status coming-soon">Coming Soon</span>
        </div>

        <div class="card">
          <div class="card-header">
            <span class="card-icon">üìä</span>
            <h3 class="card-title">System Info</h3>
          </div>
          <p class="card-description">
            Comprehensive system and hardware information dashboard.
          </p>
          <span class="card-status coming-soon">Coming Soon</span>
        </div>
      </div>
    </section>

    <!-- Advanced Features Category -->
    <section class="category-section fade-in">
      <div class="category-header">
        <span class="category-icon">üöÄ</span>
        <h2 class="category-title">Advanced Features</h2>
        <span class="category-count">4 features</span>
      </div>

      <div class="features-grid">
        <div class="card">
          <div class="card-header">
            <span class="card-icon">üì∏</span>
            <h3 class="card-title">Screen Capture</h3>
          </div>
          <p class="card-description">
            Screenshot and screen recording with source selection and editing.
          </p>
          <span class="card-status coming-soon">Coming Soon</span>
        </div>

        <div class="card">
          <div class="card-header">
            <span class="card-icon">üñ®Ô∏è</span>
            <h3 class="card-title">Printing & PDF</h3>
          </div>
          <p class="card-description">
            Print pages and generate PDFs with custom settings and watermarks.
          </p>
          <span class="card-status coming-soon">Coming Soon</span>
        </div>

        <div class="card">
          <div class="card-header">
            <span class="card-icon">üîó</span>
            <h3 class="card-title">Custom Protocol</h3>
          </div>
          <p class="card-description">
            Register custom URL protocols for deep linking and app launching.
          </p>
          <span class="card-status coming-soon">Coming Soon</span>
        </div>

        <div class="card">
          <div class="card-header">
            <span class="card-icon">‚¨ÜÔ∏è</span>
            <h3 class="card-title">Auto Updates</h3>
          </div>
          <p class="card-description">
            Automatic update checking, downloading, and installation flow.
          </p>
          <span class="card-status coming-soon">Coming Soon</span>
        </div>
      </div>
    </section>

    <!-- Footer -->
    <footer class="footer">
      <p>Built with Electron ‚Ä¢ Node.js <span id="node-version">...</span> ‚Ä¢ Chrome <span id="chrome-version">...</span></p>
      <p style="margin-top: var(--space-2);">Step 8 Complete: Persistent Storage - electron-store Integration ‚úì</p>
    </footer>
  </div>

  <!-- JavaScript -->
  <script>
    /**
     * Notification System Setup
     */
    function setupNotificationSystem() {
      const api = window.electronAPI;
      if (!api) return;

      // Helper function to log events
      function logEvent(message) {
        const logContent = document.getElementById('notification-log-content');
        if (logContent) {
          const timestamp = new Date().toLocaleTimeString();
          const entry = document.createElement('div');
          entry.textContent = `[${timestamp}] ${message}`;
          entry.style.marginBottom = '4px';
          logContent.appendChild(entry);
          logContent.scrollTop = logContent.scrollHeight;

          // Limit log entries to last 20
          while (logContent.children.length > 20) {
            logContent.removeChild(logContent.firstChild);
          }
        }
      }

      // Helper function to update stats
      async function updateStats() {
        try {
          const stats = await api.getNotificationStats();
          document.getElementById('stats-total').textContent = stats.totalShown;
          document.getElementById('stats-history').textContent = stats.historyCount;
          document.getElementById('stats-queued').textContent = stats.queuedCount;
          document.getElementById('stats-active').textContent = stats.activeCount;

          // Update DND status display
          const dndStatus = document.getElementById('dnd-status');
          if (dndStatus) {
            dndStatus.textContent = stats.doNotDisturb ? 'DND: On üîï' : 'DND: Off üîî';
            document.getElementById('notify-dnd-toggle').style.background =
              stats.doNotDisturb ? 'var(--accent-red)' : 'var(--bg-tertiary)';
          }
        } catch (error) {
          console.error('Error updating stats:', error);
        }
      }

      // Basic notification buttons
      document.getElementById('notify-info')?.addEventListener('click', async () => {
        const result = await api.showNotificationTyped('info', 'Information',
          'This is an info notification from Electron Feature Explorer!');
        logEvent(`Info notification shown (ID: ${result.id})`);
        await updateStats();
      });

      document.getElementById('notify-success')?.addEventListener('click', async () => {
        const result = await api.showNotificationTyped('success', 'Success! üéâ',
          'Your action completed successfully. Click to focus the app.');
        logEvent(`Success notification shown (ID: ${result.id})`);
        await updateStats();
      });

      document.getElementById('notify-warning')?.addEventListener('click', async () => {
        const result = await api.showNotificationTyped('warning', 'Warning',
          'This is a warning notification. Please pay attention!');
        logEvent(`Warning notification shown (ID: ${result.id})`);
        await updateStats();
      });

      document.getElementById('notify-error')?.addEventListener('click', async () => {
        const result = await api.showNotificationTyped('error', 'Error',
          'An error occurred! This is a critical notification.');
        logEvent(`Error notification shown (ID: ${result.id})`);
        await updateStats();
      });

      // Advanced notification buttons
      document.getElementById('notify-with-actions')?.addEventListener('click', async () => {
        const result = await api.showNotification({
          title: 'Notification with Actions',
          body: 'This notification has action buttons. Try clicking them!',
          actions: [
            { type: 'button', text: 'Accept' },
            { type: 'button', text: 'Decline' }
          ]
        });
        logEvent(`Notification with actions shown (ID: ${result.id})`);
        await updateStats();
      });

      document.getElementById('notify-with-reply')?.addEventListener('click', async () => {
        const result = await api.showNotification({
          title: 'Quick Reply',
          body: 'You can reply directly to this notification!',
          hasReply: true,
          replyPlaceholder: 'Type your reply here...'
        });
        logEvent(`Notification with reply shown (ID: ${result.id})`);
        await updateStats();
      });

      document.getElementById('notify-silent')?.addEventListener('click', async () => {
        const result = await api.showNotification({
          title: 'Silent Notification',
          body: 'This notification is silent (no sound).',
          silent: true
        });
        logEvent(`Silent notification shown (ID: ${result.id})`);
        await updateStats();
      });

      // Do Not Disturb toggle
      document.getElementById('notify-dnd-toggle')?.addEventListener('click', async () => {
        const result = await api.toggleDND();
        logEvent(`Do Not Disturb ${result.enabled ? 'enabled' : 'disabled'}`);
        await updateStats();
      });

      // View history
      document.getElementById('notify-show-history')?.addEventListener('click', async () => {
        const history = await api.getNotificationHistory(10);
        logEvent(`History: ${history.length} notifications`);
        if (history.length > 0) {
          console.log('Notification History:', history);
          alert(`Last ${history.length} notifications:\n\n` +
            history.slice(0, 5).map((n, i) => `${i + 1}. ${n.title}: ${n.body}`).join('\n') +
            (history.length > 5 ? '\n\n...and more (see console)' : ''));
        } else {
          alert('No notification history yet.');
        }
      });

      // View queue
      document.getElementById('notify-show-queue')?.addEventListener('click', async () => {
        const queue = await api.getNotificationQueue();
        logEvent(`Queue: ${queue.length} notifications`);
        if (queue.length > 0) {
          console.log('Notification Queue:', queue);
          alert(`${queue.length} notifications in queue:\n\n` +
            queue.map((n, i) => `${i + 1}. ${n.title}: ${n.body}`).join('\n'));
        } else {
          alert('No notifications in queue.');
        }
      });

      // Close all notifications
      document.getElementById('notify-close-all')?.addEventListener('click', async () => {
        const result = await api.closeAllNotifications();
        logEvent(`Closed ${result.count} active notification(s)`);
        await updateStats();
      });

      // Listen for notification events
      api.on('notification:reply-received', (data) => {
        logEvent(`Reply received: "${data.reply}"`);
        console.log('Notification reply:', data);
      });

      api.on('notification:action-clicked', (data) => {
        logEvent(`Action clicked: ${data.action.text}`);
        console.log('Notification action:', data);
      });

      // Initial stats update
      updateStats();

      // Update stats periodically
      setInterval(updateStats, 5000);
    }

    // Verify that electronAPI is available and populate version info
    if (window.electronAPI) {
      console.log('‚úì Electron API is available');
      console.log('Platform:', window.electronAPI.platform);
      console.log('Versions:', window.electronAPI.versions);

      // Display platform and version info
      document.getElementById('platform').textContent = window.electronAPI.platform;
      document.getElementById('node-version').textContent = window.electronAPI.versions.node;
      document.getElementById('chrome-version').textContent = window.electronAPI.versions.chrome;
      document.getElementById('electron-version').textContent = window.electronAPI.versions.electron;
    } else {
      console.error('‚úó Electron API is NOT available - check preload.js');
    }

    // Add staggered animation delays to cards
    document.addEventListener('DOMContentLoaded', () => {
      const cards = document.querySelectorAll('.card');
      cards.forEach((card, index) => {
        card.style.animationDelay = `${index * 0.05}s`;
        card.classList.add('fade-in');
      });

      // Notification System Handlers
      setupNotificationSystem();

      // File Dialog handlers
      const resultContent = document.getElementById('dialog-result-content');
      let lastSelectedFile = null;

      function setResult(text, isError = false) {
        resultContent.innerHTML = text;
        resultContent.style.color = isError ? 'var(--accent-red)' : 'var(--text-secondary)';
      }

      const dialogOpenBtn = document.getElementById('dialog-open');
      if (dialogOpenBtn && window.electronAPI?.openFileDialog) {
        dialogOpenBtn.addEventListener('click', async () => {
          const result = await window.electronAPI.openFileDialog({
            title: 'Select a file to open',
            filters: [
              { name: 'Text Files', extensions: ['txt', 'md', 'json'] },
              { name: 'Images', extensions: ['png', 'jpg', 'jpeg', 'gif'] },
              { name: 'All Files', extensions: ['*'] }
            ]
          });
          if (!result.canceled && result.filePaths.length > 0) {
            lastSelectedFile = result.filePaths[0];
            setResult(`‚úì Selected: <strong>${result.filePaths[0]}</strong>`);
          } else {
            setResult('Dialog canceled');
          }
          console.log('Open file result:', result);
        });
      }

      const dialogSaveBtn = document.getElementById('dialog-save');
      if (dialogSaveBtn && window.electronAPI?.saveFileDialog) {
        dialogSaveBtn.addEventListener('click', async () => {
          const result = await window.electronAPI.saveFileDialog({
            title: 'Save file as',
            defaultPath: 'my-document.txt',
            filters: [
              { name: 'Text Files', extensions: ['txt'] },
              { name: 'Markdown', extensions: ['md'] },
              { name: 'All Files', extensions: ['*'] }
            ]
          });
          if (!result.canceled && result.filePath) {
            setResult(`‚úì Save location: <strong>${result.filePath}</strong>`);
            // Demo: Write some content
            await window.electronAPI.writeFile(result.filePath, `Sample content created at ${new Date().toLocaleString()}`);
            setResult(`‚úì File saved: <strong>${result.filePath}</strong>`);
          } else {
            setResult('Dialog canceled');
          }
          console.log('Save file result:', result);
        });
      }

      const dialogDirBtn = document.getElementById('dialog-directory');
      if (dialogDirBtn && window.electronAPI?.selectDirectoryDialog) {
        dialogDirBtn.addEventListener('click', async () => {
          const result = await window.electronAPI.selectDirectoryDialog({
            title: 'Select a directory'
          });
          if (!result.canceled && result.filePaths.length > 0) {
            setResult(`‚úì Directory: <strong>${result.filePaths[0]}</strong>`);
          } else {
            setResult('Dialog canceled');
          }
          console.log('Select directory result:', result);
        });
      }

      const dialogMultipleBtn = document.getElementById('dialog-multiple');
      if (dialogMultipleBtn && window.electronAPI?.openFilesDialog) {
        dialogMultipleBtn.addEventListener('click', async () => {
          const result = await window.electronAPI.openFilesDialog({
            title: 'Select multiple files',
            filters: [
              { name: 'All Files', extensions: ['*'] }
            ]
          });
          if (!result.canceled && result.filePaths.length > 0) {
            setResult(`‚úì Selected <strong>${result.filePaths.length}</strong> file(s):<br>` +
              result.filePaths.map(f => `‚Ä¢ ${f}`).slice(0, 5).join('<br>') +
              (result.filePaths.length > 5 ? '<br>...and more' : ''));
          } else {
            setResult('Dialog canceled');
          }
          console.log('Open multiple files result:', result);
        });
      }

      // Message Box handlers
      document.getElementById('msgbox-info')?.addEventListener('click', async () => {
        const result = await window.electronAPI.showMessageBox({
          type: 'info',
          title: 'Information',
          message: 'This is an informational message box',
          detail: 'You can display important information to users using this dialog.',
          buttons: ['Got it', 'Cancel']
        });
        setResult(`Info box - Button clicked: ${result.response === 0 ? 'Got it' : 'Cancel'}`);
      });

      document.getElementById('msgbox-warning')?.addEventListener('click', async () => {
        const result = await window.electronAPI.showMessageBox({
          type: 'warning',
          title: 'Warning',
          message: 'This is a warning message',
          detail: 'Are you sure you want to proceed with this action?',
          buttons: ['Proceed', 'Cancel'],
          defaultId: 1
        });
        setResult(`Warning box - Button clicked: ${result.response === 0 ? 'Proceed' : 'Cancel'}`);
      });

      document.getElementById('msgbox-error')?.addEventListener('click', async () => {
        const result = await window.electronAPI.showMessageBox({
          type: 'error',
          title: 'Error',
          message: 'An error has occurred',
          detail: 'The operation could not be completed. Please try again.',
          buttons: ['Retry', 'Ignore', 'Cancel'],
          defaultId: 2
        });
        const buttonText = ['Retry', 'Ignore', 'Cancel'][result.response];
        setResult(`Error box - Button clicked: ${buttonText}`);
      });

      document.getElementById('msgbox-question')?.addEventListener('click', async () => {
        const result = await window.electronAPI.showMessageBox({
          type: 'question',
          title: 'Question',
          message: 'Do you want to save your changes?',
          detail: 'Your changes will be lost if you don\'t save them.',
          buttons: ['Save', 'Don\'t Save', 'Cancel'],
          defaultId: 0
        });
        const buttonText = ['Save', 'Don\'t Save', 'Cancel'][result.response];
        setResult(`Question box - Button clicked: ${buttonText}`);
      });

      // File Operations handlers
      document.getElementById('file-read-preview')?.addEventListener('click', async () => {
        if (!lastSelectedFile) {
          setResult('‚ö† Please select a file first using "Open File" button', true);
          return;
        }

        const result = await window.electronAPI.readFile(lastSelectedFile);
        if (result.success) {
          const preview = result.content.substring(0, 200) + (result.content.length > 200 ? '...' : '');
          setResult(`‚úì Read file: <strong>${result.metadata.name}</strong><br>` +
            `Size: ${(result.metadata.size / 1024).toFixed(2)} KB<br>` +
            `Preview: <div style="margin-top: 8px; padding: 8px; background: var(--bg-primary); border-radius: 4px; font-family: monospace; font-size: 11px; white-space: pre-wrap;">${preview}</div>`);
        } else {
          setResult(`‚úó Error reading file: ${result.error}`, true);
        }
      });

      document.getElementById('file-metadata')?.addEventListener('click', async () => {
        if (!lastSelectedFile) {
          setResult('‚ö† Please select a file first using "Open File" button', true);
          return;
        }

        const result = await window.electronAPI.getFileMetadata(lastSelectedFile);
        if (result.success) {
          const m = result.metadata;
          setResult(`<strong>File Metadata:</strong><br>` +
            `Name: ${m.name}<br>` +
            `Size: ${(m.size / 1024).toFixed(2)} KB<br>` +
            `Extension: ${m.extension || 'none'}<br>` +
            `Type: ${m.isFile ? 'File' : 'Directory'}<br>` +
            `Created: ${new Date(m.created).toLocaleString()}<br>` +
            `Modified: ${new Date(m.modified).toLocaleString()}`);
        } else {
          setResult(`‚úó Error getting metadata: ${result.error}`, true);
        }
      });

      document.getElementById('file-recent')?.addEventListener('click', async () => {
        const result = await window.electronAPI.getRecentFiles();
        if (result.recentFiles.length > 0) {
          setResult(`<strong>Recent Files (${result.recentFiles.length}):</strong><br>` +
            result.recentFiles.map((f, i) => `${i + 1}. ${f}`).join('<br>'));
        } else {
          setResult('No recent files yet. Open a file to add it to the list.');
        }
      });

      // Drag and Drop handlers
      const dropZone = document.getElementById('drop-zone');
      const droppedFilesDiv = document.getElementById('dropped-files');

      if (dropZone) {
        // Prevent default drag behaviors
        ['dragenter', 'dragover', 'dragleave', 'drop'].forEach(eventName => {
          dropZone.addEventListener(eventName, (e) => {
            e.preventDefault();
            e.stopPropagation();
          });
        });

        // Visual feedback on drag
        ['dragenter', 'dragover'].forEach(eventName => {
          dropZone.addEventListener(eventName, () => {
            dropZone.style.borderColor = 'var(--accent-blue)';
            dropZone.style.background = 'var(--bg-secondary)';
          });
        });

        ['dragleave', 'drop'].forEach(eventName => {
          dropZone.addEventListener(eventName, () => {
            dropZone.style.borderColor = 'var(--border)';
            dropZone.style.background = 'var(--bg-tertiary)';
          });
        });

        // Handle drop
        dropZone.addEventListener('drop', async (e) => {
          const files = Array.from(e.dataTransfer.files);

          if (files.length > 0) {
            droppedFilesDiv.innerHTML = `<div style="color: var(--text-primary); margin-bottom: 8px;"><strong>Dropped ${files.length} file(s):</strong></div>`;

            for (const file of files) {
              const fileInfo = document.createElement('div');
              fileInfo.style.marginBottom = '4px';
              fileInfo.style.padding = '4px 8px';
              fileInfo.style.background = 'var(--bg-primary)';
              fileInfo.style.borderRadius = '4px';
              fileInfo.innerHTML = `üìÑ ${file.name} (${(file.size / 1024).toFixed(2)} KB) - ${file.type || 'unknown type'}`;
              droppedFilesDiv.appendChild(fileInfo);

              // Set as last selected file
              lastSelectedFile = file.path;
            }
          }
        });

        // Click to open file dialog
        dropZone.addEventListener('click', async () => {
          const result = await window.electronAPI.openFilesDialog({
            title: 'Select files'
          });

          if (!result.canceled && result.filePaths.length > 0) {
            droppedFilesDiv.innerHTML = `<div style="color: var(--text-primary); margin-bottom: 8px;"><strong>Selected ${result.filePaths.length} file(s):</strong></div>`;

            for (const filePath of result.filePaths) {
              const metadata = await window.electronAPI.getFileMetadata(filePath);
              if (metadata.success) {
                const fileInfo = document.createElement('div');
                fileInfo.style.marginBottom = '4px';
                fileInfo.style.padding = '4px 8px';
                fileInfo.style.background = 'var(--bg-primary)';
                fileInfo.style.borderRadius = '4px';
                fileInfo.innerHTML = `üìÑ ${metadata.metadata.name} (${(metadata.metadata.size / 1024).toFixed(2)} KB)`;
                droppedFilesDiv.appendChild(fileInfo);

                lastSelectedFile = filePath;
              }
            }
          }
        });
      }

      // Persistent Storage handlers
      const storeResultContent = document.getElementById('store-result-content');

      function setStoreResult(text, isError = false) {
        storeResultContent.innerHTML = text;
        storeResultContent.style.color = isError ? 'var(--accent-red)' : 'var(--text-secondary)';
      }

      async function updateStoreStats() {
        const result = await window.electronAPI.storeGetStats();
        if (result.success) {
          document.getElementById('stats-keys').textContent = result.stats.keys;
          document.getElementById('stats-size').textContent = result.stats.size;
          document.getElementById('stats-secrets').textContent = result.stats.secretsCount;
          document.getElementById('stats-path').textContent = result.stats.path;
        }
      }

      // Basic CRUD operations
      document.getElementById('store-set')?.addEventListener('click', async () => {
        const key = document.getElementById('store-key').value;
        const value = document.getElementById('store-value').value;

        if (!key) {
          setStoreResult('‚ö† Please enter a key', true);
          return;
        }

        // Try to parse value as JSON if it looks like JSON
        let parsedValue = value;
        if (value.startsWith('{') || value.startsWith('[')) {
          try {
            parsedValue = JSON.parse(value);
          } catch (e) {
            // Keep as string if not valid JSON
          }
        }

        const result = await window.electronAPI.storeSet(key, parsedValue);
        if (result.success) {
          setStoreResult(`‚úì Set <strong>${key}</strong> = ${JSON.stringify(parsedValue)}`);
          await updateStoreStats();
        } else {
          setStoreResult(`‚úó Error: ${result.error}`, true);
        }
      });

      document.getElementById('store-get')?.addEventListener('click', async () => {
        const key = document.getElementById('store-key').value;

        if (!key) {
          setStoreResult('‚ö† Please enter a key', true);
          return;
        }

        const result = await window.electronAPI.storeGet(key);
        if (result.success) {
          if (result.value !== undefined) {
            setStoreResult(`‚úì <strong>${key}</strong> = <div style="margin-top: 8px; padding: 8px; background: var(--bg-primary); border-radius: 4px; font-family: monospace;">${JSON.stringify(result.value, null, 2)}</div>`);
          } else {
            setStoreResult(`‚ö† Key <strong>${key}</strong> does not exist`);
          }
        } else {
          setStoreResult(`‚úó Error: ${result.error}`, true);
        }
      });

      document.getElementById('store-delete')?.addEventListener('click', async () => {
        const key = document.getElementById('store-key').value;

        if (!key) {
          setStoreResult('‚ö† Please enter a key', true);
          return;
        }

        const result = await window.electronAPI.storeDelete(key);
        if (result.success) {
          setStoreResult(`‚úì Deleted key: <strong>${key}</strong>`);
          await updateStoreStats();
        } else {
          setStoreResult(`‚úó Error: ${result.error}`, true);
        }
      });

      document.getElementById('store-has')?.addEventListener('click', async () => {
        const key = document.getElementById('store-key').value;

        if (!key) {
          setStoreResult('‚ö† Please enter a key', true);
          return;
        }

        const result = await window.electronAPI.storeHas(key);
        if (result.success) {
          setStoreResult(`Key <strong>${key}</strong> ${result.exists ? '‚úì exists' : '‚úó does not exist'}`);
        } else {
          setStoreResult(`‚úó Error: ${result.error}`, true);
        }
      });

      // Encrypted secrets operations
      document.getElementById('secret-set')?.addEventListener('click', async () => {
        const key = document.getElementById('secret-key').value;
        const value = document.getElementById('secret-value').value;

        if (!key || !value) {
          setStoreResult('‚ö† Please enter both key and value', true);
          return;
        }

        const result = await window.electronAPI.storeSetSecret(key, value);
        if (result.success) {
          setStoreResult(`‚úì Encrypted and stored secret: <strong>${key}</strong> üîí`);
          document.getElementById('secret-value').value = ''; // Clear password field
          await updateStoreStats();
        } else {
          setStoreResult(`‚úó Error: ${result.error}`, true);
        }
      });

      document.getElementById('secret-get')?.addEventListener('click', async () => {
        const key = document.getElementById('secret-key').value;

        if (!key) {
          setStoreResult('‚ö† Please enter a secret key', true);
          return;
        }

        const result = await window.electronAPI.storeGetSecret(key);
        if (result.success && result.value) {
          setStoreResult(`‚úì Decrypted secret <strong>${key}</strong>: <div style="margin-top: 8px; padding: 8px; background: var(--bg-primary); border-radius: 4px; font-family: monospace;">${result.value}</div>`);
        } else if (result.success && !result.value) {
          setStoreResult(`‚ö† Secret <strong>${key}</strong> does not exist`);
        } else {
          setStoreResult(`‚úó Error: ${result.error}`, true);
        }
      });

      document.getElementById('secret-delete')?.addEventListener('click', async () => {
        const key = document.getElementById('secret-key').value;

        if (!key) {
          setStoreResult('‚ö† Please enter a secret key', true);
          return;
        }

        const result = await window.electronAPI.storeDeleteSecret(key);
        if (result.success) {
          setStoreResult(`‚úì Deleted secret: <strong>${key}</strong>`);
          await updateStoreStats();
        } else {
          setStoreResult(`‚úó Error: ${result.error}`, true);
        }
      });

      // Management operations
      document.getElementById('store-view-all')?.addEventListener('click', async () => {
        const result = await window.electronAPI.storeGetAll();
        if (result.success) {
          const data = result.data;
          const keys = Object.keys(data);
          if (keys.length > 0) {
            setStoreResult(`<strong>All Data (${keys.length} keys):</strong><div style="margin-top: 8px; padding: 8px; background: var(--bg-primary); border-radius: 4px; font-family: monospace; white-space: pre-wrap; max-height: 150px; overflow-y: auto;">${JSON.stringify(data, null, 2)}</div>`);
          } else {
            setStoreResult('Store is empty');
          }
        } else {
          setStoreResult(`‚úó Error: ${result.error}`, true);
        }
      });

      document.getElementById('store-export')?.addEventListener('click', async () => {
        const includeSecrets = confirm('Include encrypted secrets in export?');
        const result = await window.electronAPI.storeExport(includeSecrets);

        if (result.success) {
          // Save to file
          const saveResult = await window.electronAPI.saveFileDialog({
            title: 'Export Store Data',
            defaultPath: `store-export-${Date.now()}.json`,
            filters: [{ name: 'JSON Files', extensions: ['json'] }]
          });

          if (!saveResult.canceled && saveResult.filePath) {
            await window.electronAPI.writeFile(saveResult.filePath, result.data);
            setStoreResult(`‚úì Exported to: <strong>${saveResult.filePath}</strong>`);
          } else {
            setStoreResult('Export canceled');
          }
        } else {
          setStoreResult(`‚úó Error: ${result.error}`, true);
        }
      });

      document.getElementById('store-import')?.addEventListener('click', async () => {
        const fileResult = await window.electronAPI.openFileDialog({
          title: 'Import Store Data',
          filters: [{ name: 'JSON Files', extensions: ['json'] }]
        });

        if (!fileResult.canceled && fileResult.filePaths.length > 0) {
          const readResult = await window.electronAPI.readFile(fileResult.filePaths[0]);

          if (readResult.success) {
            const merge = confirm('Merge with existing data? (Cancel = replace all)');
            const importResult = await window.electronAPI.storeImport(readResult.content, merge);

            if (importResult.success) {
              setStoreResult(`‚úì Imported data from: <strong>${fileResult.filePaths[0]}</strong> (${merge ? 'merged' : 'replaced'})`);
              await updateStoreStats();
            } else {
              setStoreResult(`‚úó Error importing: ${importResult.error}`, true);
            }
          } else {
            setStoreResult(`‚úó Error reading file: ${readResult.error}`, true);
          }
        } else {
          setStoreResult('Import canceled');
        }
      });

      document.getElementById('store-reset')?.addEventListener('click', async () => {
        if (!confirm('Reset all data to defaults? This cannot be undone!')) {
          return;
        }

        const result = await window.electronAPI.storeReset();
        if (result.success) {
          setStoreResult('‚úì Store reset to defaults');
          await updateStoreStats();
        } else {
          setStoreResult(`‚úó Error: ${result.error}`, true);
        }
      });

      // Initial stats update
      updateStoreStats();

      // Update stats periodically
      setInterval(updateStoreStats, 5000);
    });
  </script>
</body>
</html>
