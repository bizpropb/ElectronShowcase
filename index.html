<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta http-equiv="Content-Security-Policy"
        content="default-src 'self'; script-src 'self' 'unsafe-inline'; style-src 'self' 'unsafe-inline'">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Electron Feature Explorer</title>

  <!-- CSS Files -->
  <link rel="stylesheet" href="styles/theme.css">
  <link rel="stylesheet" href="styles/animations.css">
  <link rel="stylesheet" href="styles/main.css">
</head>
<body>
  <div class="container">
    <!-- Header -->
    <header class="header fade-in">
      <div class="header-title">
        <span class="icon">‚ö°</span>
        <h1>Electron Feature Explorer</h1>
      </div>
      <p class="header-subtitle">
        A comprehensive showcase of Electron's native desktop capabilities
      </p>
      <div class="flex items-center gap-4 mt-4">
        <span class="badge success">‚úì Secure</span>
        <span class="badge info">Platform: <span id="platform">...</span></span>
        <span class="badge">Electron <span id="electron-version">...</span></span>
      </div>
    </header>

    <!-- Window Management Category -->
    <section class="category-section fade-in">
      <div class="category-header">
        <span class="category-icon">ü™ü</span>
        <h2 class="category-title">Window Management</h2>
        <span class="category-count">4 features</span>
      </div>

      <div class="features-grid">
        <div class="card">
          <div class="card-header">
            <span class="card-icon">üé®</span>
            <h3 class="card-title">Multi-Window</h3>
          </div>
          <p class="card-description">
            Create and manage multiple windows with proper lifecycle management and state persistence.
          </p>
          <span class="card-status coming-soon">Coming Soon</span>
        </div>

        <div class="card">
          <div class="card-header">
            <span class="card-icon">üñºÔ∏è</span>
            <h3 class="card-title">Frameless Window</h3>
          </div>
          <p class="card-description">
            Custom window chrome with draggable regions and custom title bar controls.
          </p>
          <span class="card-status coming-soon">Coming Soon</span>
        </div>

        <div class="card">
          <div class="card-header">
            <span class="card-icon">üëª</span>
            <h3 class="card-title">Transparent Window</h3>
          </div>
          <p class="card-description">
            Create overlay windows with transparency and click-through functionality.
          </p>
          <span class="card-status coming-soon">Coming Soon</span>
        </div>

        <div class="card">
          <div class="card-header">
            <span class="card-icon">üìê</span>
            <h3 class="card-title">Window State</h3>
          </div>
          <p class="card-description">
            Persist window bounds, position, and state across application restarts.
          </p>
          <span class="card-status coming-soon">Coming Soon</span>
        </div>
      </div>
    </section>

    <!-- System Integration Category -->
    <section class="category-section fade-in">
      <div class="category-header">
        <span class="category-icon">‚öôÔ∏è</span>
        <h2 class="category-title">System Integration</h2>
        <span class="category-count">5 features</span>
      </div>

      <div class="features-grid">
        <div class="card" id="notifications-card" style="grid-column: span 2;">
          <div class="card-header">
            <span class="card-icon">üîî</span>
            <h3 class="card-title">Desktop Notifications System</h3>
          </div>
          <p class="card-description">
            Comprehensive notification system with actions, replies, Do Not Disturb, queue management, and history tracking.
          </p>

          <!-- Notification Types -->
          <div style="margin-top: var(--space-4);">
            <h4 style="font-size: var(--font-size-sm); color: var(--text-secondary); margin-bottom: var(--space-2);">Basic Notifications</h4>
            <div style="display: grid; grid-template-columns: repeat(4, 1fr); gap: var(--space-2);">
              <button class="btn btn-primary" id="notify-info">Info</button>
              <button class="btn btn-success" id="notify-success">Success</button>
              <button class="btn btn-warning" id="notify-warning">Warning</button>
              <button class="btn btn-error" id="notify-error">Error</button>
            </div>
          </div>

          <!-- Advanced Notifications -->
          <div style="margin-top: var(--space-4);">
            <h4 style="font-size: var(--font-size-sm); color: var(--text-secondary); margin-bottom: var(--space-2);">Advanced Features</h4>
            <div style="display: grid; grid-template-columns: repeat(3, 1fr); gap: var(--space-2);">
              <button class="btn btn-primary" id="notify-with-actions">With Actions</button>
              <button class="btn btn-primary" id="notify-with-reply">With Reply</button>
              <button class="btn btn-primary" id="notify-silent">Silent</button>
            </div>
          </div>

          <!-- Do Not Disturb & Management -->
          <div style="margin-top: var(--space-4);">
            <h4 style="font-size: var(--font-size-sm); color: var(--text-secondary); margin-bottom: var(--space-2);">Management & Controls</h4>
            <div style="display: grid; grid-template-columns: repeat(4, 1fr); gap: var(--space-2);">
              <button class="btn" id="notify-dnd-toggle" style="background: var(--bg-tertiary);">
                <span id="dnd-status">DND: Off</span>
              </button>
              <button class="btn" id="notify-show-history">View History</button>
              <button class="btn" id="notify-show-queue">View Queue</button>
              <button class="btn" id="notify-close-all">Close All</button>
            </div>
          </div>

          <!-- Statistics Display -->
          <div id="notification-stats" style="margin-top: var(--space-4); padding: var(--space-3); background: var(--bg-tertiary); border-radius: 6px; font-size: var(--font-size-xs); color: var(--text-secondary);">
            <strong>Stats:</strong>
            <span id="stats-total">0</span> total ‚Ä¢
            <span id="stats-history">0</span> in history ‚Ä¢
            <span id="stats-queued">0</span> queued ‚Ä¢
            <span id="stats-active">0</span> active
          </div>

          <!-- Event Log -->
          <div id="notification-log" style="margin-top: var(--space-3); padding: var(--space-3); background: var(--bg-tertiary); border-radius: 6px; max-height: 120px; overflow-y: auto; font-size: var(--font-size-xs); font-family: monospace; color: var(--text-secondary);">
            <div style="color: var(--text-primary); margin-bottom: var(--space-2);">Event Log:</div>
            <div id="notification-log-content">Ready to show notifications...</div>
          </div>

          <span class="card-status ready">‚úì Ready</span>
        </div>

        <div class="card">
          <div class="card-header">
            <span class="card-icon">üìã</span>
            <h3 class="card-title">System Tray</h3>
          </div>
          <p class="card-description">
            Persistent tray icon with context menu and quick actions.
          </p>
          <span class="card-status coming-soon">Coming Soon</span>
        </div>

        <div class="card">
          <div class="card-header">
            <span class="card-icon">üéØ</span>
            <h3 class="card-title">App Menu</h3>
          </div>
          <p class="card-description">
            Native application menu with keyboard shortcuts and dynamic items.
          </p>
          <span class="card-status coming-soon">Coming Soon</span>
        </div>

        <div class="card">
          <div class="card-header">
            <span class="card-icon">‚å®Ô∏è</span>
            <h3 class="card-title">Global Shortcuts</h3>
          </div>
          <p class="card-description">
            Register system-wide keyboard shortcuts for quick app control.
          </p>
          <span class="card-status coming-soon">Coming Soon</span>
        </div>

        <div class="card">
          <div class="card-header">
            <span class="card-icon">üñ±Ô∏è</span>
            <h3 class="card-title">Context Menus</h3>
          </div>
          <p class="card-description">
            Rich right-click context menus with dynamic items and submenus.
          </p>
          <span class="card-status coming-soon">Coming Soon</span>
        </div>
      </div>
    </section>

    <!-- File System Category -->
    <section class="category-section fade-in">
      <div class="category-header">
        <span class="category-icon">üìÅ</span>
        <h2 class="category-title">File System</h2>
        <span class="category-count">4 features</span>
      </div>

      <div class="features-grid">
        <div class="card" id="file-dialogs-card">
          <div class="card-header">
            <span class="card-icon">üìÇ</span>
            <h3 class="card-title">File Dialogs</h3>
          </div>
          <p class="card-description">
            Native open, save, and directory selection dialogs with filters.
          </p>
          <div style="margin-top: var(--space-4); display: grid; grid-template-columns: 1fr 1fr; gap: var(--space-2);">
            <button class="btn btn-primary" id="dialog-open">Open File</button>
            <button class="btn btn-primary" id="dialog-multiple">Open Multiple</button>
            <button class="btn btn-success" id="dialog-directory">Select Folder</button>
            <button class="btn btn-warning" id="dialog-save">Create File</button>
          </div>
          <div id="dialog-result" style="margin-top: var(--space-3); font-size: var(--font-size-xs); color: var(--text-secondary);"></div>
          <span class="card-status ready">‚úì Ready</span>
        </div>

        <div class="card">
          <div class="card-header">
            <span class="card-icon">üéØ</span>
            <h3 class="card-title">Drag & Drop</h3>
          </div>
          <p class="card-description">
            Handle file drops with preview, validation, and processing.
          </p>
          <span class="card-status coming-soon">Coming Soon</span>
        </div>

        <div class="card">
          <div class="card-header">
            <span class="card-icon">üíæ</span>
            <h3 class="card-title">Persistent Storage</h3>
          </div>
          <p class="card-description">
            Encrypted key-value storage with schema validation and migrations.
          </p>
          <span class="card-status coming-soon">Coming Soon</span>
        </div>

        <div class="card">
          <div class="card-header">
            <span class="card-icon">üëÄ</span>
            <h3 class="card-title">File Watcher</h3>
          </div>
          <p class="card-description">
            Monitor files and directories for real-time change detection.
          </p>
          <span class="card-status coming-soon">Coming Soon</span>
        </div>
      </div>
    </section>

    <!-- OS Integration Category -->
    <section class="category-section fade-in">
      <div class="category-header">
        <span class="category-icon">üíª</span>
        <h2 class="category-title">OS Integration</h2>
        <span class="category-count">4 features</span>
      </div>

      <div class="features-grid">
        <div class="card">
          <div class="card-header">
            <span class="card-icon">üìã</span>
            <h3 class="card-title">Clipboard</h3>
          </div>
          <p class="card-description">
            Full clipboard access with multiple formats and history tracking.
          </p>
          <span class="card-status coming-soon">Coming Soon</span>
        </div>

        <div class="card">
          <div class="card-header">
            <span class="card-icon">üöÄ</span>
            <h3 class="card-title">Shell Integration</h3>
          </div>
          <p class="card-description">
            Open external URLs, reveal files, and execute shell commands.
          </p>
          <span class="card-status coming-soon">Coming Soon</span>
        </div>

        <div class="card">
          <div class="card-header">
            <span class="card-icon">üîã</span>
            <h3 class="card-title">Power Management</h3>
          </div>
          <p class="card-description">
            Monitor battery status, suspend/resume events, and idle detection.
          </p>
          <span class="card-status coming-soon">Coming Soon</span>
        </div>

        <div class="card">
          <div class="card-header">
            <span class="card-icon">üìä</span>
            <h3 class="card-title">System Info</h3>
          </div>
          <p class="card-description">
            Comprehensive system and hardware information dashboard.
          </p>
          <span class="card-status coming-soon">Coming Soon</span>
        </div>
      </div>
    </section>

    <!-- Advanced Features Category -->
    <section class="category-section fade-in">
      <div class="category-header">
        <span class="category-icon">üöÄ</span>
        <h2 class="category-title">Advanced Features</h2>
        <span class="category-count">4 features</span>
      </div>

      <div class="features-grid">
        <div class="card">
          <div class="card-header">
            <span class="card-icon">üì∏</span>
            <h3 class="card-title">Screen Capture</h3>
          </div>
          <p class="card-description">
            Screenshot and screen recording with source selection and editing.
          </p>
          <span class="card-status coming-soon">Coming Soon</span>
        </div>

        <div class="card">
          <div class="card-header">
            <span class="card-icon">üñ®Ô∏è</span>
            <h3 class="card-title">Printing & PDF</h3>
          </div>
          <p class="card-description">
            Print pages and generate PDFs with custom settings and watermarks.
          </p>
          <span class="card-status coming-soon">Coming Soon</span>
        </div>

        <div class="card">
          <div class="card-header">
            <span class="card-icon">üîó</span>
            <h3 class="card-title">Custom Protocol</h3>
          </div>
          <p class="card-description">
            Register custom URL protocols for deep linking and app launching.
          </p>
          <span class="card-status coming-soon">Coming Soon</span>
        </div>

        <div class="card">
          <div class="card-header">
            <span class="card-icon">‚¨ÜÔ∏è</span>
            <h3 class="card-title">Auto Updates</h3>
          </div>
          <p class="card-description">
            Automatic update checking, downloading, and installation flow.
          </p>
          <span class="card-status coming-soon">Coming Soon</span>
        </div>
      </div>
    </section>

    <!-- Footer -->
    <footer class="footer">
      <p>Built with Electron ‚Ä¢ Node.js <span id="node-version">...</span> ‚Ä¢ Chrome <span id="chrome-version">...</span></p>
      <p style="margin-top: var(--space-2);">Step 5 Complete: Rich Desktop Notification System ‚úì</p>
    </footer>
  </div>

  <!-- JavaScript -->
  <script>
    /**
     * Notification System Setup
     */
    function setupNotificationSystem() {
      const api = window.electronAPI;
      if (!api) return;

      // Helper function to log events
      function logEvent(message) {
        const logContent = document.getElementById('notification-log-content');
        if (logContent) {
          const timestamp = new Date().toLocaleTimeString();
          const entry = document.createElement('div');
          entry.textContent = `[${timestamp}] ${message}`;
          entry.style.marginBottom = '4px';
          logContent.appendChild(entry);
          logContent.scrollTop = logContent.scrollHeight;

          // Limit log entries to last 20
          while (logContent.children.length > 20) {
            logContent.removeChild(logContent.firstChild);
          }
        }
      }

      // Helper function to update stats
      async function updateStats() {
        try {
          const stats = await api.getNotificationStats();
          document.getElementById('stats-total').textContent = stats.totalShown;
          document.getElementById('stats-history').textContent = stats.historyCount;
          document.getElementById('stats-queued').textContent = stats.queuedCount;
          document.getElementById('stats-active').textContent = stats.activeCount;

          // Update DND status display
          const dndStatus = document.getElementById('dnd-status');
          if (dndStatus) {
            dndStatus.textContent = stats.doNotDisturb ? 'DND: On üîï' : 'DND: Off üîî';
            document.getElementById('notify-dnd-toggle').style.background =
              stats.doNotDisturb ? 'var(--accent-red)' : 'var(--bg-tertiary)';
          }
        } catch (error) {
          console.error('Error updating stats:', error);
        }
      }

      // Basic notification buttons
      document.getElementById('notify-info')?.addEventListener('click', async () => {
        const result = await api.showNotificationTyped('info', 'Information',
          'This is an info notification from Electron Feature Explorer!');
        logEvent(`Info notification shown (ID: ${result.id})`);
        await updateStats();
      });

      document.getElementById('notify-success')?.addEventListener('click', async () => {
        const result = await api.showNotificationTyped('success', 'Success! üéâ',
          'Your action completed successfully. Click to focus the app.');
        logEvent(`Success notification shown (ID: ${result.id})`);
        await updateStats();
      });

      document.getElementById('notify-warning')?.addEventListener('click', async () => {
        const result = await api.showNotificationTyped('warning', 'Warning',
          'This is a warning notification. Please pay attention!');
        logEvent(`Warning notification shown (ID: ${result.id})`);
        await updateStats();
      });

      document.getElementById('notify-error')?.addEventListener('click', async () => {
        const result = await api.showNotificationTyped('error', 'Error',
          'An error occurred! This is a critical notification.');
        logEvent(`Error notification shown (ID: ${result.id})`);
        await updateStats();
      });

      // Advanced notification buttons
      document.getElementById('notify-with-actions')?.addEventListener('click', async () => {
        const result = await api.showNotification({
          title: 'Notification with Actions',
          body: 'This notification has action buttons. Try clicking them!',
          actions: [
            { type: 'button', text: 'Accept' },
            { type: 'button', text: 'Decline' }
          ]
        });
        logEvent(`Notification with actions shown (ID: ${result.id})`);
        await updateStats();
      });

      document.getElementById('notify-with-reply')?.addEventListener('click', async () => {
        const result = await api.showNotification({
          title: 'Quick Reply',
          body: 'You can reply directly to this notification!',
          hasReply: true,
          replyPlaceholder: 'Type your reply here...'
        });
        logEvent(`Notification with reply shown (ID: ${result.id})`);
        await updateStats();
      });

      document.getElementById('notify-silent')?.addEventListener('click', async () => {
        const result = await api.showNotification({
          title: 'Silent Notification',
          body: 'This notification is silent (no sound).',
          silent: true
        });
        logEvent(`Silent notification shown (ID: ${result.id})`);
        await updateStats();
      });

      // Do Not Disturb toggle
      document.getElementById('notify-dnd-toggle')?.addEventListener('click', async () => {
        const result = await api.toggleDND();
        logEvent(`Do Not Disturb ${result.enabled ? 'enabled' : 'disabled'}`);
        await updateStats();
      });

      // View history
      document.getElementById('notify-show-history')?.addEventListener('click', async () => {
        const history = await api.getNotificationHistory(10);
        logEvent(`History: ${history.length} notifications`);
        if (history.length > 0) {
          console.log('Notification History:', history);
          alert(`Last ${history.length} notifications:\n\n` +
            history.slice(0, 5).map((n, i) => `${i + 1}. ${n.title}: ${n.body}`).join('\n') +
            (history.length > 5 ? '\n\n...and more (see console)' : ''));
        } else {
          alert('No notification history yet.');
        }
      });

      // View queue
      document.getElementById('notify-show-queue')?.addEventListener('click', async () => {
        const queue = await api.getNotificationQueue();
        logEvent(`Queue: ${queue.length} notifications`);
        if (queue.length > 0) {
          console.log('Notification Queue:', queue);
          alert(`${queue.length} notifications in queue:\n\n` +
            queue.map((n, i) => `${i + 1}. ${n.title}: ${n.body}`).join('\n'));
        } else {
          alert('No notifications in queue.');
        }
      });

      // Close all notifications
      document.getElementById('notify-close-all')?.addEventListener('click', async () => {
        const result = await api.closeAllNotifications();
        logEvent(`Closed ${result.count} active notification(s)`);
        await updateStats();
      });

      // Listen for notification events
      api.on('notification:reply-received', (data) => {
        logEvent(`Reply received: "${data.reply}"`);
        console.log('Notification reply:', data);
      });

      api.on('notification:action-clicked', (data) => {
        logEvent(`Action clicked: ${data.action.text}`);
        console.log('Notification action:', data);
      });

      // Initial stats update
      updateStats();

      // Update stats periodically
      setInterval(updateStats, 5000);
    }

    // Verify that electronAPI is available and populate version info
    if (window.electronAPI) {
      console.log('‚úì Electron API is available');
      console.log('Platform:', window.electronAPI.platform);
      console.log('Versions:', window.electronAPI.versions);

      // Display platform and version info
      document.getElementById('platform').textContent = window.electronAPI.platform;
      document.getElementById('node-version').textContent = window.electronAPI.versions.node;
      document.getElementById('chrome-version').textContent = window.electronAPI.versions.chrome;
      document.getElementById('electron-version').textContent = window.electronAPI.versions.electron;
    } else {
      console.error('‚úó Electron API is NOT available - check preload.js');
    }

    // Add staggered animation delays to cards
    document.addEventListener('DOMContentLoaded', () => {
      const cards = document.querySelectorAll('.card');
      cards.forEach((card, index) => {
        card.style.animationDelay = `${index * 0.05}s`;
        card.classList.add('fade-in');
      });

      // Notification System Handlers
      setupNotificationSystem();

      // File Dialog handlers
      const resultDiv = document.getElementById('dialog-result');

      const dialogOpenBtn = document.getElementById('dialog-open');
      if (dialogOpenBtn && window.electronAPI?.openFileDialog) {
        dialogOpenBtn.addEventListener('click', async () => {
          const result = await window.electronAPI.openFileDialog({
            title: 'Select a file to open',
            filters: [
              { name: 'Text Files', extensions: ['txt', 'md'] },
              { name: 'Images', extensions: ['png', 'jpg', 'jpeg', 'gif'] },
              { name: 'All Files', extensions: ['*'] }
            ]
          });
          if (!result.canceled && result.filePaths.length > 0) {
            resultDiv.textContent = `Selected: ${result.filePaths[0]}`;
          } else {
            resultDiv.textContent = 'Dialog canceled';
          }
          console.log('Open file result:', result);
        });
      }

      const dialogSaveBtn = document.getElementById('dialog-save');
      if (dialogSaveBtn && window.electronAPI?.saveFileDialog) {
        dialogSaveBtn.addEventListener('click', async () => {
          const result = await window.electronAPI.saveFileDialog({
            title: 'Save file as',
            defaultPath: 'document.txt',
            filters: [
              { name: 'Text Files', extensions: ['txt'] },
              { name: 'All Files', extensions: ['*'] }
            ]
          });
          if (!result.canceled && result.filePath) {
            resultDiv.textContent = `Save to: ${result.filePath}`;
          } else {
            resultDiv.textContent = 'Dialog canceled';
          }
          console.log('Save file result:', result);
        });
      }

      const dialogDirBtn = document.getElementById('dialog-directory');
      if (dialogDirBtn && window.electronAPI?.selectDirectoryDialog) {
        dialogDirBtn.addEventListener('click', async () => {
          const result = await window.electronAPI.selectDirectoryDialog({
            title: 'Select a directory'
          });
          if (!result.canceled && result.filePaths.length > 0) {
            resultDiv.textContent = `Selected: ${result.filePaths[0]}`;
          } else {
            resultDiv.textContent = 'Dialog canceled';
          }
          console.log('Select directory result:', result);
        });
      }

      const dialogMultipleBtn = document.getElementById('dialog-multiple');
      if (dialogMultipleBtn && window.electronAPI?.openFilesDialog) {
        dialogMultipleBtn.addEventListener('click', async () => {
          const result = await window.electronAPI.openFilesDialog({
            title: 'Select multiple files'
          });
          if (!result.canceled && result.filePaths.length > 0) {
            resultDiv.textContent = `Selected ${result.filePaths.length} file(s)`;
          } else {
            resultDiv.textContent = 'Dialog canceled';
          }
          console.log('Open multiple files result:', result);
        });
      }
    });
  </script>
</body>
</html>
