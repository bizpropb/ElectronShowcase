<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta http-equiv="Content-Security-Policy"
        content="default-src 'self'; script-src 'self' 'unsafe-inline'; style-src 'self' 'unsafe-inline'">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Electron Feature Explorer</title>

  <!-- CSS Files -->
  <link rel="stylesheet" href="styles/theme.css">
  <link rel="stylesheet" href="styles/animations.css">
  <link rel="stylesheet" href="styles/main.css">

</head>
<body>
  <div class="container">
    <!-- Header -->
    <header class="header fade-in">
      <div class="header-title">
        <span class="icon">⚡</span>
        <h1>Electron Feature Explorer</h1>
      </div>
      <p class="header-subtitle">
        A comprehensive showcase of Electron's native desktop capabilities
      </p>
      <div class="flex items-center gap-4 mt-4">
        <span class="badge success">✓ Secure</span>
        <span class="badge info">Platform: <span id="platform">...</span></span>
        <span class="badge">Electron <span id="electron-version">...</span></span>
      </div>
    </header>

    <!-- Tab Navigation -->
    <nav class="tab-navigation">
      <button class="tab-btn active" data-tab="window-management">🪟 Window Management</button>
      <button class="tab-btn" data-tab="system-integration">⚙️ System Integration</button>
      <button class="tab-btn" data-tab="file-system">📁 File System</button>
      <button class="tab-btn" data-tab="os-integration">💻 OS Integration</button>
      <button class="tab-btn" data-tab="advanced-features">🚀 Advanced Features</button>
    </nav>

    <!-- Tab container - content loaded here -->
    <div id="tab-container"></div>
  </div>

  <script>
    // Calculate the actual height of header + tabs
    function getHeaderTabsHeight() {
      const header = document.querySelector('header');
      const tabs = document.querySelector('.tab-navigation');
      const headerHeight = header ? header.offsetHeight : 0;
      const tabsHeight = tabs ? tabs.offsetHeight : 0;
      const total = headerHeight + tabsHeight;
      console.log('Measured heights:', { headerHeight, tabsHeight, total });
      return total;
    }

    // Initialize platform info display
    if (window.electronAPI) {
      window.electronAPI.getPlatform().then(platform => {
        document.getElementById('platform').textContent = platform;
      });

      window.electronAPI.getElectronVersion().then(version => {
        document.getElementById('electron-version').textContent = version;
      });
    }

    // Load tab content via fetch and inject into DOM
    async function loadTab(tabName) {
      const container = document.getElementById('tab-container');
      try {
        const response = await fetch(`pages/${tabName}.html`);
        const html = await response.text();

        // Extract body content from the fetched HTML
        const parser = new DOMParser();
        const doc = parser.parseFromString(html, 'text/html');
        const bodyContent = doc.body.innerHTML;

        // Inject into container
        container.innerHTML = bodyContent;

        // Re-execute scripts in the loaded content
        const scripts = container.querySelectorAll('script');
        scripts.forEach(oldScript => {
          const newScript = document.createElement('script');
          Array.from(oldScript.attributes).forEach(attr => {
            newScript.setAttribute(attr.name, attr.value);
          });
          newScript.textContent = oldScript.textContent;
          oldScript.parentNode.replaceChild(newScript, oldScript);
        });
      } catch (error) {
        console.error('Error loading tab:', error);
        container.innerHTML = '<p>Error loading content</p>';
      }
    }

    // Tab switching logic
    document.querySelectorAll('.tab-btn').forEach(btn => {
      btn.addEventListener('click', () => {
        const tab = btn.dataset.tab;

        // Update active state in UI
        document.querySelectorAll('.tab-btn').forEach(b => b.classList.remove('active'));
        btn.classList.add('active');

        // Load content
        loadTab(tab);
      });
    });

    // Load initial tab
    window.addEventListener('DOMContentLoaded', () => {
      loadTab('window-management');
    });
  </script>
</body>
</html>
